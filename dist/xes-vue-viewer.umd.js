!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["xes-vue-viewer"]=t()}(this,(function(){"use strict";const e=document.addEventListener?function(e,t,i){e&&t&&i&&e.addEventListener(t,i,!1)}:function(e,t,i){e&&t&&i&&e.attachEvent("on"+t,i)},t=document.removeEventListener?function(e,t,i){e&&t&&e.removeEventListener(t,i,!1)}:function(e,t,i){e&&t&&e.detachEvent("on"+t,i)};function i(e){let t=!1;return function(...i){t||(t=!0,window.requestAnimationFrame((n=>{e.apply(this,i),t=!1})))}}let n="";const s={CONTAIN:{name:"contain",icon:"imgs-viewer-icon-full-screen"},ORIGINAL:{name:"original",icon:"imgs-viewer-icon-scale-to-original"}},o=window.navigator.userAgent.match(/firefox/i)?"DOMMouseScroll":"mousewheel";function a(e,t,i,n,s,o,a,l,r,A){"boolean"!=typeof a&&(r=l,l=a,a=!1);const d="function"==typeof i?i.options:i;let c;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,s&&(d.functional=!0)),n&&(d._scopeId=n),o?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,r(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=c):t&&(c=a?function(e){t.call(this,A(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),c)if(d.functional){const e=d.render;d.render=function(t,i){return c.call(i),e(t,i)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,c):[c]}return i}const l={name:"xesImageViewer",props:{value:{type:Boolean,default:!1},imgList:{type:Array,default:()=>[]},zIndex:{type:Number,default:2e3},closeOnClickMask:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},onSwitch:{type:Function,default:()=>{}},initialIndex:{type:Number,default:0},showPreNextBar:{type:Boolean,default:!1},spaceAction:{type:Boolean,default:!1}},data:()=>({index:1,isShow:!1,infinite:!0,loading:!0,mode:s.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1},styleObject:{left:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAMAAACOj/wDAAAAw1BMVEUAAAD////////V1dX////m5v/s7Ozt7e3j6urn7e3u7u7l6urp7e3q6u/o7PDp7PDs7PDn6u7o6+vq7fDo6u3o6u3o6u3o6+3o6+0jKjIlLTQlLTYoLTYtNDs0O0M+RU1ARU1ARU9ASE1ASE9DSE9DSk9FSlJPVFxXXmZmbXRqb3dyd353fIGGjZKIi5Kcoaawtbqyt7q1ury1ur+3ur+6vMHJy9DN0NXN0tXS1dfV19rV19zX2t/a3N/c3+Hm6evp6+4qrPShAAAAQXRSTlMAAQMGCAobHSUqLjE5PkJEREpNVFdiY2VmZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ2dnZ8cgP78AAAEmSURBVCjPjVPrWoJAEB3v4o1UEHdok8qMli5IRaUFvP9TSXtjjT7r/GBn9nxndm4AaLS61nBodVtQQ6M/8woOb9ZvHHO9eWFg3jNlo+IHRlrcnBY1TJuSnOirt09tTgQ30Bdb+lhpB99cZ6HcJyT3mSYXnZIcK29HCEEaxsofA7S9wlCurxGjXBbcBstIcUsf8mRNmHQtOBPGy8VH+X0vs93doIxsgyOMW3xV+mcMheGAy88vGuQ6+hUVObuw5Gfq31VPs/OUn0upTH1WJ135ZkaDiryUYR2wxUWIieISlZCt6oxxsxfWfqVKsXSHGFlxbbIhke6Q6m0eIQaMBYgs172tphKH1PerxvOpGPPM0jQ7nqe5CQYm/9mhk9t3em//2Pjf/5UD92qGWsIjc4UAAAAASUVORK5CYII=)"},right:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAMAAACOj/wDAAAAxlBMVEUAAAD////////V1dXf///m5v/j4+zj7Ozl7e3q6vHs7PPn5+3p6e7q6u/p6e3q6u7r6+/p6ezn6u7o6+7n6u3n6u3n6u3o6u3o6+3o6+0jKDIlKjQlLTQoLTQtMjw0OUM8Q0tBRk1BRlBBSFBDSFBDS1JQVVxXXGRmbnNpbnVrbnVrcHVrcHhzeH14e4KHjJGeoKWytLmyt7m0uby3ub65vMHIys/Izc/Nz9TN0tTU19nU19zX2d7X3N7Z3N7c3uHm6Ovo6+0r4PhZAAAAQnRSTlMAAQMGCAobGx0kKSouMDk9QURJTFRWYWJkZWZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmZmb5zakAAAABLklEQVQoz41T61qDMAzt7hu7wS6MNViHcyJOVGTiZSr0/V9K1jalc983PX960tMkbZISotFo94fDfrtBTlDrTT0u4E17tWOtO+MGZl3TbcR/YaSd6xN+gkldibbe+nrT1JbaoDr/yJ41Hxy01kLb+QOFJzQWrVIco5WEDCilH2iPCWmq5xUxwNW14cm9JrEU3dL1rjBzcm4RR8WEdRnv872kr5c7ueeQuSQh7NDhBW4kmRNX3pMFOloRsG9BXLIUa+bfVbluLzKxLpVn5keVGCnRVTnNsDxgucrp4IVS1FII8bYWPmW1l2y/gQTfiRWK6Ub4pit6ryuEtS22AEEUBQBxoWtbdaUsvO+zMDG7YvQzz7L8uJ/mJBiw/zNDZ6fv/Nz+MfHir3QOf6Vj/JUf5xmIwoqkohEAAAAASUVORK5CYII=)"},zoomIn:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAMAAACOj/wDAAAAZlBMVEUAAAD////////////V1dXf3//m5ubr6/Xj4+zl5e3q6urm7Ozs7Ozu7u7q6u/o7e3m6urn6+vo7Ozq6u3n6+7r6+7p6e3n6u3q6u3n6uzn6u3o6u3o6+0jKDItMj2GiJCusbbo6+3CwQ6CAAAAInRSTlMAAQMFBggKGhsdJCkpLTA4PUFDSEtLU1VVYGFjZGVlZWVlJicZ9AAAAKVJREFUKM99k9kSgyAMReO+1H2rirXm/3+yRVpLFe55YnImA4QL0YEXZUWRRR5dcNJO8I7oUuffJQNrDIneVvKJ8mh2W77Quh9Zs4FauZyN5NKFs1nO4VtWbKEiCoRNioAytnKjxi4bGu1ypEkttqfGpmoTLWqxPjRWVVtwJ9jzjk8L7wknBGeLXwW+J04CzhBMH87tnvj+m/j+nHiJH8u/Evu/ygu2Dk3A1o14FAAAAABJRU5ErkJggg==)"},zoomOut:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAdCAMAAACOj/wDAAAAaVBMVEUAAAD////////////V1dXf3//m5ubr6/Xj4+zl5e3q6urm7Ozs7Ozu7u7q6u/o7e3m6urn6+vo7Ozq6u3n6+7r6+7p6e3n6u3q6u3n6uzn6u3o6u3o6+0jKDIoLTgtMj2GiJCusbbo6+3l0BztAAAAI3RSTlMAAQMFBggKGhsdJCkpLTA4PUFDSEtLU1VVYGFjZGVlZWVlZVUsa0YAAACySURBVCjPfZPXGoMgDIXjHnWvqogj7/+QLWo1Vcl/A8khHwEOAAeWFyVJ5FlwwwgrgSuiCo1/LWiQ0AS0LMUL6VFslnijNHcxxwfyTYvxkVhpbn8mluWc9+5XzMjqcSRBBuAIEktJAuFAhDoRX1DoxQJavdhCt/c5K6Rch73nDoZtMknCtOUGvpLZ8813y56TvSH2bvlXYd+TdwLvIdZ9vG9Xx9c/x9dXxytsX/0V3z4zH4WuT3b/8eOlAAAAAElFTkSuQmCC)"},closeIcon:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAMAAADW3miqAAAATlBMVEUAAAD///////////////////////////////////////////////////////////////////+ztLhdYmkzOkEzOkIzOUEnLzcnLjghKDEGubhbAAAAGnRSTlMAAQQKESMtNE1TYmZnbHZ9f4CayOvr7Pb3/kWvMwcAAADaSURBVDjLjZTZEoQwCATH+4xx4qrJ///oPuxqYbzoN6iuQgkACPKq6Qdrh76pclySlO3InbEtk7NTGEaYIlLSmhfUqXSyjpd0mXAMbzC7lXa8pdsq1nyg/v8XHykAIDHPkkkAlHyhBNC+SS2Qj2/SmKOS8TQ7knTLJLMVGhkuwTvS+TDLbINehs4H75wP3slsj4GxFTscYBlbYT06tFeSP0mncut6Lqf68EMLPlsLlmMLjs1cfs2co2aqnkX1wLpRUQ2danx1i6BbKdVy6tZcdzB0p0d5xJ7O4RdktUSNmxngfwAAAABJRU5ErkJggg==)"},arrowLeft:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYBAMAAAASWSDLAAAAKlBMVEUAAACHj5yHj5uHkJqHjZqIjpuIkJqHj5uHj5uIj5qHjpqIj5uHjpuHjprMFZ6qAAAADXRSTlMAZGZ3eXp8fX+Ljo+RBm7mywAAADFJREFUGNNjYKASCERic19B4uxdgCRxixiJWiQJht4JSByem8hWniVW6jKyVBJVvAsAUYoNtAleIHcAAAAASUVORK5CYII=)"},arrowRight:{"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYBAMAAAASWSDLAAAAKlBMVEUAAACHj5yHj5uHkJqHjZqIjpuIkJqHj5uIkJyIj5qHjpqIj5uHjpuHjpoWQGgfAAAADXRSTlMAZGZ3eXp8fX6Ljo+ROw7PewAAADFJREFUGNNjYKAGEEXm+G5A4nDdRpZaS6zUdSQO5w0kztwDSBJ3iJGwRZJgUGOgEgAA4/4NAIl5KTAAAAAASUVORK5CYII=)"}}}),computed:{isSingle(){return this.imgList.length<=1},isFirst(){return 0===this.initialIndex},isLast(){return this.initialIndex===this.imgList.length-1},isSimple(){return"string"==typeof this.imgList[0]},currentImg(){return this.imgList.length?this.isSimple?this.imgList[this.initialIndex]:this.imgList[this.initialIndex].url:null},currentTitle(){return this.imgList.length&&!this.isSimple?this.imgList[this.initialIndex].title:""},imgStyle(){const{scale:e,deg:t,offsetX:i,offsetY:n,enableTransition:o}=this.transform,a={transform:`scale(${e}) rotate(${t}deg)`,transition:o?"transform .3s":"","margin-left":`${i}px`,"margin-top":`${n}px`};return this.mode===s.CONTAIN&&(a.maxWidth=a.maxHeight="100%"),a}},watch:{value(e){this.imgList.length?e?(this.deviceSupportInstall(),document.body.appendChild(this.$el),n=document.body.style.overflow,document.body.style.overflow="hidden"):(this.deviceSupportUninstall(),document.body.removeChild(this.$el),document.body.style.overflow=n,this.reset()):e&&this.hide()},initialIndex(e){this.imgList.length&&e<this.imgList.length&&(this.initialIndex=e)},index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg(e){this.$nextTick((e=>{const t=this.$refs.img;t&&!t.complete&&(this.loading=!0)}))}},methods:{hide(){this.$emit("input",!1)},deviceSupportInstall(){this._keyDownHandler=i((e=>{switch(e.keyCode){case 27:this.closeOnPressEscape&&this.hide();break;case 32:this.spaceAction&&this.toggleMode();break;case 37:this.showPreNextBar&&this.prev();break;case 38:this.handleActions("zoomIn");break;case 39:this.showPreNextBar&&this.next();break;case 40:this.handleActions("zoomOut")}})),this._mouseWheelHandler=i((e=>{(e.wheelDelta?e.wheelDelta:-e.detail)>0?this.handleActions("zoomIn",{zoomRate:.03,enableTransition:!1}):this.handleActions("zoomOut",{zoomRate:.03,enableTransition:!1})})),e(document,"keydown",this._keyDownHandler),e(document,o,this._mouseWheelHandler)},deviceSupportUninstall(){t(document,"keydown",this._keyDownHandler),t(document,o,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad(e){this.loading=!1},handleImgError(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown(n){if(this.loading||0!==n.button)return;const{offsetX:s,offsetY:o}=this.transform,a=n.pageX,l=n.pageY;this._dragHandler=i((e=>{this.transform.offsetX=s+e.pageX-a,this.transform.offsetY=o+e.pageY-l})),e(document,"mousemove",this._dragHandler),e(document,"mouseup",(e=>{t(document,"mousemove",this._dragHandler)})),n.preventDefault()},reset(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode(){if(this.loading)return;const e=Object.keys(s),t=(Object.values(s).indexOf(this.mode)+1)%e.length;this.mode=s[e[t]],this.reset()},prev(){if(this.isFirst&&!this.infinite)return;const e=this.imgList.length;this.initialIndex=(this.initialIndex-1+e)%e},next(){if(this.isLast&&!this.infinite)return;const e=this.imgList.length;this.initialIndex=(this.initialIndex+1)%e},handleActions(e,t={}){if(this.loading)return;const{zoomRate:i,rotateDeg:n,enableTransition:s}={zoomRate:.2,rotateDeg:90,enableTransition:!0,...t},{transform:o}=this;switch(e){case"zoomOut":o.scale>.2&&(o.scale=parseFloat((o.scale-i).toFixed(3)));break;case"zoomIn":o.scale=parseFloat((o.scale+i).toFixed(3));break;case"clocelise":o.deg+=n;break;case"anticlocelise":o.deg-=n}o.enableTransition=s}}};var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"fade"}},[e.imgList.length&&e.value?i("div",{staticClass:"image-viewer__wrapper",style:{"z-index":e.zIndex}},[i("div",{staticClass:"image-viewer__mask",on:{click:function(t){e.closeOnClickMask&&e.hide()}}}),e._v(" "),e.loading?i("div",{staticClass:"image-viewer__loading"},[i("svg",{staticClass:"image-viewer__loading__lodingSvg",attrs:{t:"1617243714833",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2206",width:"100",height:"100"}},[i("path",{attrs:{d:"M395.636364 157.533091a157.533091 155.159273 90 1 0 310.318545 0 157.533091 155.159273 90 1 0-310.318545 0Z","p-id":"2207",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M46.545455 551.377455a118.155636 116.363636 90 1 0 232.727272 0 118.155636 116.363636 90 1 0-232.727272 0Z","p-id":"2208",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M802.909091 275.688727a19.688727 19.386182 90 1 0 38.772364 0 19.688727 19.386182 90 1 0-38.772364 0Z","p-id":"2209",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M366.778182 186.088727a121.483636 121.483636 0 0 0-174.778182 0c-48.244364 49.477818-48.244364 129.722182 0 179.2a121.483636 121.483636 0 0 0 174.778182 0c48.244364-49.477818 48.244364-129.722182 0-179.2z","p-id":"2210",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M899.863273 551.377455a39.377455 38.795636 90 1 0 77.591272 0 39.377455 38.795636 90 1 0-77.591272 0Z","p-id":"2211",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M766.557091 829.533091a59.066182 58.181818 90 1 0 116.363636 0 59.066182 58.181818 90 1 0-116.363636 0Z","p-id":"2212",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M473.227636 945.221818a78.778182 77.568 90 1 0 155.136 0 78.778182 77.568 90 1 0-155.136 0Z","p-id":"2213",fill:"#e6e6e6"}}),i("path",{attrs:{d:"M182.295273 827.066182a98.466909 96.977455 90 1 0 193.954909 0 98.466909 96.977455 90 1 0-193.954909 0Z","p-id":"2214",fill:"#e6e6e6"}})])]):e._e(),e._v(" "),i("span",{staticClass:"image-viewer__btn image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"icon",style:e.styleObject.closeIcon})]),e._v(" "),!e.isSingle&&e.showPreNextBar?[i("span",{staticClass:"image-viewer__btn image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},style:e.styleObject.arrowLeft,on:{click:e.prev}},[i("i",{staticClass:"imgs-viewer-icon imgs-viewer-icon-arrow-left-bold"})]),e._v(" "),i("span",{staticClass:"image-viewer__btn image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},style:e.styleObject.arrowRight,on:{click:e.next}},[i("i",{staticClass:"imgs-viewer-icon imgs-viewer-icon-arrow-right-bold"})])]:e._e(),e._v(" "),e.currentTitle?i("div",{staticClass:"image-viewer__title"},[e._v("\n      "+e._s(e.currentTitle)+"\n    ")]):e._e(),e._v(" "),i("div",{staticClass:"image-viewer__btn image-viewer__actions"},[i("div",{staticClass:"image-viewer__actions__inner"},[i("div",{staticClass:"actions-block"},[i("i",{staticClass:"icon left-rotation",style:e.styleObject.left,on:{click:function(t){return e.handleActions("anticlocelise")}}}),e._v(" "),i("span",{staticClass:"font-tip"},[e._v("左旋转")])]),e._v(" "),i("div",{staticClass:"actions-block"},[i("i",{staticClass:"icon right-rotation",style:e.styleObject.right,on:{click:function(t){return e.handleActions("clocelise")}}}),e._v(" "),i("span",{staticClass:"font-tip"},[e._v("右旋转")])]),e._v(" "),i("i",{staticClass:"image-viewer__actions__divider"}),e._v(" "),i("div",{staticClass:"actions-block"},[i("i",{staticClass:"icon zoom-out",style:e.styleObject.zoomOut,on:{click:function(t){return e.handleActions("zoomIn")}}}),e._v(" "),i("span",{staticClass:"font-tip"},[e._v("放大")])]),e._v(" "),i("div",{staticClass:"actions-block"},[i("i",{staticClass:"icon zoom-in",style:e.styleObject.zoomIn,on:{click:function(t){return e.handleActions("zoomOut")}}}),e._v(" "),i("span",{staticClass:"font-tip"},[e._v("缩小")])])])]),e._v(" "),i("div",{staticClass:"image-viewer__canvas"},[i("img",{key:e.currentImg,ref:"img",staticClass:"image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}})])],2):e._e()])};r._withStripped=!0;const A=a({render:r,staticRenderFns:[]},undefined,l,"data-v-f4e4d550",false,undefined,!1,void 0,void 0,void 0);return A.install=function(e){e.component(A.name,A)},"undefined"!=typeof window&&window.Vue&&window.Vue.component(A.name,A),A}));
